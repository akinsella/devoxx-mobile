var Lawnchair=function(){if(!JSON)throw"JSON unavailable! Include http://www.json.org/json2.js to fix.";if(arguments.length<=2&&arguments.length>0){var a=typeof arguments[0]==="function"?arguments[0]:arguments[1],b=typeof arguments[0]==="function"?{}:arguments[0]}else{throw"Incorrect # of ctor args!"}if(typeof a!=="function")throw"No callback was provided";var c=!(this instanceof Lawnchair)?new Lawnchair(b,a):this;c.record=b.record||"record";c.name=b.name||"records";var d;if(b.adapter){d=Lawnchair.adapters[c.indexOf(Lawnchair.adapters,b.adapter)];d=d.valid()?d:undefined}else{for(var e=0,f=Lawnchair.adapters.length;e<f;e++){d=Lawnchair.adapters[e].valid()?Lawnchair.adapters[e]:undefined;if(d)break}}if(!d)throw"No valid adapter.";for(var g in d)c[g]=d[g];for(var e=0,f=Lawnchair.plugins.length;e<f;e++)Lawnchair.plugins[e].call(c);c.init(b,a);return c};Lawnchair.adapters=[];Lawnchair.adapter=function(a,b){b["adapter"]=a;var c="adapter valid init keys save batch get exists all remove nuke".split(" "),d=this.prototype.indexOf;for(var e in b){if(d(c,e)===-1)throw"Invalid adapter! Nonstandard method: "+e}Lawnchair.adapters.push(b)};Lawnchair.plugins=[];Lawnchair.plugin=function(a){for(var b in a)b==="init"?Lawnchair.plugins.push(a[b]):this.prototype[b]=a[b]};Lawnchair.prototype={isArray:Array.isArray||function(a){return Object.prototype.toString.call(a)==="[object Array]"},indexOf:function(a,b,c,d){if(a.indexOf)return a.indexOf(b);for(c=0,d=a.length;c<d;c++)if(a[c]===b)return c;return-1},lambda:function(a){return this.fn(this.record,a)},fn:function(a,b){return typeof b=="string"?new Function(a,b):b},uuid:function(){var a=function(){return((1+Math.random())*65536|0).toString(16).substring(1)};return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()},each:function(a){var b=this.lambda(a);if(this.__results){for(var c=0,d=this.__results.length;c<d;c++)b.call(this,this.__results[c],c)}else{this.all(function(a){for(var c=0,d=a.length;c<d;c++)b.call(this,a[c],c)})}return this}};Lawnchair.adapter("dom",{valid:function(){return!!window.Storage},init:function(a,b){this.storage=window.localStorage;var c=this;this.indexer={key:c.name+"._index_",all:function(){var a=JSON.parse(c.storage.getItem(this.key));if(a==null)c.storage.setItem(this.key,JSON.stringify([]));return JSON.parse(c.storage.getItem(this.key))},add:function(a){var b=this.all();b.push(a);c.storage.setItem(this.key,JSON.stringify(b))},del:function(a){var b=this.all(),d=[];for(var e=0,f=b.length;e<f;e++){if(b[e]!=a)d.push(b[e])}c.storage.setItem(this.key,JSON.stringify(d))},find:function(a){var b=this.all();for(var c=0,d=b.length;c<d;c++){if(a===b[c])return c}return false}};if(b)this.fn(this.name,b).call(this,this)},save:function(a,b){var c=a.key||this.uuid();if(!this.indexer.find(c))this.indexer.add(c);delete a.key;this.storage.setItem(c,JSON.stringify(a));if(b){a.key=c;this.lambda(b).call(this,a)}return this},batch:function(a,b){var c=[];for(var d=0,e=a.length;d<e;d++){this.save(a[d],function(a){c.push(a)})}if(b)this.lambda(b).call(this,c);return this},keys:function(a,b){var c=a.limit||null,d=a.offset||0;if(b)this.lambda(b).call(this,this.indexer.all())},get:function(a,b){if(this.isArray(a)){var c=[];for(var d=0,e=a.length;d<e;d++){var f=JSON.parse(this.storage.getItem(a[d]));if(f){f.key=a[d];c.push(f)}}if(b)this.lambda(b).call(this,c)}else{var f=JSON.parse(this.storage.getItem(a));if(f)f.key=a;if(b)this.lambda(b).call(this,f)}return this},all:function(a){var b=this.indexer.all(),c=[],d;for(var e=0,f=b.length;e<f;e++){d=JSON.parse(this.storage.getItem(b[e]));d.key=b[e];c.push(d)}if(a)this.fn(this.name,a).call(this,c);return this},remove:function(a,b){var c=typeof a==="string"?a:a.key;this.indexer.del(c);this.storage.removeItem(c);if(b)this.lambda(b).call(this);return this},nuke:function(a){this.all(function(b){for(var c=0,d=b.length;c<d;c++){this.remove(b[c])}if(a)this.lambda(a).call(this)});return this}});Lawnchair.adapter("window-name",function(a,b){var c=window.top.name?JSON.parse(window.top.name):{};return{valid:function(){return typeof window.top.name!="undefined"},init:function(d,e){c[this.name]={index:[],store:{}};a=c[this.name].index;b=c[this.name].store;this.fn(this.name,e).call(this,this)},keys:function(b){this.fn("keys",b).call(this,a);return this},save:function(d,e){var f=d.key||this.uuid();if(d.key)delete d.key;this.exists(f,function(g){if(!g)a.push(f);b[f]=d;window.top.name=JSON.stringify(c);if(e){d.key=f;this.lambda(e).call(this,d)}});return this},batch:function(a,b){var c=[];for(var d=0,e=a.length;d<e;d++){this.save(a[d],function(a){c.push(a)})}if(b)this.lambda(b).call(this,c);return this},get:function(a,c){var d;if(this.isArray(a)){d=[];for(var e=0,f=a.length;e<f;e++){d.push(b[a[e]])}}else{d=b[a];if(d)d.key=a}if(c)this.lambda(c).call(this,d);return this},exists:function(a,c){this.lambda(c).call(this,!!b[a]);return this},all:function(c){var d=[];for(var e=0,f=a.length;e<f;e++){var g=b[a[e]];g.key=a[e];d.push(g)}this.fn(this.name,c).call(this,d);return this},remove:function(d,e){var f=this.isArray(d)?d:[d];for(var g=0,h=f.length;g<h;g++){delete b[f[g]];a.splice(this.indexOf(a,f[g]),1)}window.top.name=JSON.stringify(c);if(e)this.lambda(e).call(this);return this},nuke:function(b){storage={};a=[];window.top.name=JSON.stringify(c);if(b)this.lambda(b).call(this);return this}}}())